package main\n\nimport (\n\t\"flag\"\n\t\"log\"\n\t\"os\"\n\t\"os/signal\"\n\t\"syscall\"\n\t\"time\"\n\n\t\"honeypot/internal/logging\"\n\t\"honeypot/internal/server\"\n\t\"honeypot/internal/store\"\n)\n\nfunc main() {\n\taddr := flag.String(\"addr\", \":8080\", \"listen address\")\n\tlogPath := flag.String(\"log\", \"events.log\", \"path to events log\")\n\tuploadDir := flag.String(\"uploads\", \"uploads\", \"directory for uploaded files\")\n\thoneypotID := flag.String(\"id\", \"hp-1\", \"honeypot identifier\")\n\trateLimit := flag.Int(\"rate\", 200, \"max requests per 60s per IP\")\n\tflag.Parse()\n\n\tif err := os.MkdirAll(*uploadDir, 0750); err != nil {\n\t\tlog.Fatalf(\"failed to create upload dir: %v\", err)\n\t}\n\n\t// Logger\n\tl, err := logging.NewJSONLogger(*logPath)\n\tif err != nil {\n\t\tlog.Fatalf(\"failed to open log file: %v\", err)\n\t}\n\tdefer l.Close()\n\n\t// File store\n\tfs := store.NewFileStore(*uploadDir)\n\n\tsrv := server.NewServer(server.Config{\n\t\tAddr:         *addr,\n\t\tLogger:       l,\n\t\tFileStore:    fs,\n\t\tHoneypotID:   *honeypotID,\n\t\tRateLimit:    *rateLimit,\n\t\tRateWindow:   time.Minute,\n\t\tTemplatesDir: \"internal/templates\",\n\t})\n\n\t// Graceful shutdown on SIGINT/SIGTERM\n\tgo func() {\n\t\tif err := srv.ListenAndServe(); err != nil {\n\t\t\tlog.Printf(\"server stopped: %v\", err)\n\t\t}\n\t}()\n\n\tsigCh := make(chan os.Signal, 1)\n\tsignal.Notify(sigCh, syscall.SIGINT, syscall.SIGTERM)\n\t<-sigCh\n\n\tlog.Println(\"shutting down honeypot\")\n\tsrv.Shutdown()\n}